# 如何使用 IPv6 连接 Spotify 和 Lyricify

<p style="font-size: smaller; color: gray;">简体中文 / <a href="./index-en">English</a></p>

最近由于不可抗力原因，大陆用户可能无法通过 IPv4 正常连接 Spotify<br>
目前的解决办法除了进行科学上网以外，还可通过使用 IPv6 来连接 Spotify

### 目录
- [如何使用 IPv6 连接 Spotify 和 Lyricify](#如何使用-ipv6-连接-spotify-和-lyricify)
    - [目录](#目录)
  - [确认网络和硬件支持 IPv6](#确认网络和硬件支持-ipv6)
    - [硬件支持](#硬件支持)
    - [网络支持](#网络支持)
    - [路由器](#路由器)
    - [光猫/网线直连](#光猫网线直连)
  - [优先使用 IPv6](#优先使用-ipv6)
    - [验证连接](#验证连接)
    - [**验证 IPv6 是否优先**](#验证-ipv6-是否优先)
  - [许可证](#许可证)

## 确认网络和硬件支持 IPv6

IPv6 需要网络和硬件同时支持才可以启用

### 硬件支持

> 本段内容仅针对 Windows 系统<br>
> 一般情况下电脑的网卡均支持 IPv6，但可能仍需设置才能启用网卡的 IPv6 功能

首先，打开控制面板，进入`网络和 Internet`>`网络和共享中心`，点击页面左侧的 `更改适配器设置` 进入 `网络连接` 页面

<img src="/IPv6/Network-connection.png" alt="网络连接页面" data-clickable />

请在 `网络连接` 页面找到您所使用的网络连接。<br>
一般情况下，带有 `WLAN` 字样的选项为无线局域网（一般为 Wi-Fi 连接），带有 `以太网` 字样的为网线连接

右键您所使用的网络连接并点击 `属性`，在弹出的窗口中寻找 `Internet 协议版本 6 (TCP/IPv6)` 选项，并确保选项被勾选。（如图所示）
> 若未找到对应选项则大概率表明您的网卡不支持 IPv6，请在网络搜索您网卡型号并获得具体信息

<img src="/IPv6/Network-attributes.png" alt="网络属性" data-clickable />

---

### 网络支持

在确保网卡已经开启 IPv6 的情况下，可以通过访问 http://testipv6.com/ 等测试网站进行测试<br>
若全部通过，则表明您的网络支持 IPv6，则无需继续进行设置

若提示未发现 IPv6 地址，则需要继续设置

> [!warning]
> 若您使用的是公共网络，请不要继续进行尝试！

### 路由器
> 以下内容使用华为路由 AX2 Pro 为例，其他品牌路由器请以实际情况为准

若您使用的是路由器连接的网络(Wi-Fi 或网线连接至路由器)，请通过路由器背面管理地址进行调整<br>
访问路由器管理页面并登录。进入 更多设置>网络设置>IPv6 页面，确保 IPv6 被开启并保存
<img src="/IPv6/Router.png" alt="路由器" data-clickable />
一般情况下，开启路由器的 IPv6 设置后即可正常使用 IPv6<br>
若仍然无法连接，则需考虑检查光猫设置

### 光猫/网线直连
> 以下内容使用移动光猫为例，其他运营商请以实际情况为准

若您在路由器启用 IPv6 后仍无法使用 IPv6，或者使用网线直连光猫，则需访问光猫管理地址进行检查<br>
一般情况下光猫的管理地址为 `192.168.1.1`，用户名及密码可在光猫背面找到
登录至管理网站后，进入 状态>网络侧信息>IPv6连接信息 页面，若有相关信息则表明您的运营商已启用 IPv6
<img src="/IPv6/ONT.png" alt="光猫" data-clickable />
但如果无法获取相关信息或无IPv6相关内容，则请联系运营商进行修改
> [!note]
> 由于目前运营商均采用动态管理员密码，故网络上通过管理员默认账号进行修改教程均已失效

完成以上操作后可再次进行测试，确认 IPv6 已经启用

## 优先使用 IPv6

在确保您的设备已经启用 IPv6 后，请尝试登录 Spotify。一般情况下已经可以正常访问

### 验证连接
可以在 `终端App` 中依次运行以下命令检测连接情况：
1. 打开 **命令提示符**（`Win + R` → `cmd` → 回车）
2. 运行：
    ```cmd
    ping -6 api.spotify.com
    ping -6 accounts.spotify.com
    ```

一般情况下可以返回 IPv6 的 Ping 值。则可以正常连接至 Spotify

但您可以仍会遇到无法连接至 Spotify 或 Lyricify 的问题，这是由于 IPv6 优先级过低导致的。

### **验证 IPv6 是否优先**
1. 打开 **命令提示符**（`Win + R` → `cmd` → 回车）
2. 运行：
   ```cmd
   netsh interface ipv6 show prefixpolicies
   ```
   - 优先级数字越大越优先
   - 如果 `::/0`（IPv6）的优先级高于 `::/96` 或 `::ffff:0:0/96`（IPv4），则 IPv6 优先
   - 如果 `::/0`（IPv6）的优先级低于 `::/96` 或 `::ffff:0:0/96`（IPv4），则 IPv4 优先

如果 IPv6 优先级低于 IPv4，请参照 [使 Windows 全局优先使用 IPv6 连接](/docs/IPv6/IPv6First) 文档的教程


或者使用 [一键提升优先级脚本](https://github.com/MiaowCham/How_to_connect_Spotify_with_IPv6/releases/latest)

> [!note]
> 重启计算机后，所有设置会恢复默认。
> 也就是说重启计算机后需要重新设置/运行脚本。

一般情况下，完成设置后即可恢复对 Spotify 和 Lyricify 的访问<br>
若完成设置后仍然无法访问，请尝试重新设置，保证无遗漏步骤，确保 IPv6 已被正确开启

## 许可证
本文档使用 CC0-1.0 许可证<br>
这意味着您可以随意使用本文档的任何内容
